<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.migro.jobcenter.mapper.BillPurchaseOrderResponseMapper">
	<select id="pagingQuery" resultType="com.migro.jobcenter.model.BillPurchaseOrderResponse" useCache="false">
		select t.* from BILL_PURCHASE_ORDER_RESPONSE t
		<where>
            <if test="cm.id != null">
                  and t.id=#{cm.id}
            </if>
			<if test="cm.plOrderId != null and cm.plOrderId != ''">
                  and t.PL_ORDER_ID=#{cm.plOrderId}
			</if>
			<if test="cm.orderId != null and cm.orderId != ''">
                  and t.ORDER_ID=#{cm.orderId}
			</if>
			<if test="cm.planId != null and cm.planId != ''">
                  and t.PLAN_ID=#{cm.planId}
			</if>
			<if test="cm.materialCode != null and cm.materialCode != ''">
                  and t.MATERIAL_CODE=#{cm.materialCode}
			</if>
			<if test="cm.respNum != null and cm.respNum != ''">
                  and t.RESP_NUM=#{cm.respNum}
			</if>
			<if test="cm.bdCode != null and cm.bdCode != ''">
                  and t.BD_CODE=#{cm.bdCode}
			</if>
            <if test="cm.createTimeStart != null">
                  and t.create_time &gt;= #{cm.createTimeStart}
                  and t.create_time &lt;= #{cm.createTimeEnd}
            </if>
            <if test="cm.updateTimeStart != null">
                  and t.update_time &gt;= #{cm.updateTimeStart}
                  and t.update_time &lt;= #{cm.updateTimeEnd}
            </if>

			<if test="cm.keyword != null and cm.keyword != ''">
                  and (
                      t.PL_ORDER_ID like CONCAT('%',#{cm.keyword},'%')
                      or  t.ORDER_ID like CONCAT('%',#{cm.keyword},'%')
                      or  t.PLAN_ID like CONCAT('%',#{cm.keyword},'%')
                      or  t.MATERIAL_CODE like CONCAT('%',#{cm.keyword},'%')
                      or  t.RESP_NUM like CONCAT('%',#{cm.keyword},'%')
                      or  t.BD_CODE like CONCAT('%',#{cm.keyword},'%')
                  )
			</if>
		</where>
        <if test="cm.orderBy != null and cm.orderBy != ''">
            order by t.${cm.orderBy}
        </if>
		<if test="cm.sortAsc != null and cm.sortAsc != ''">
			${cm.sortAsc}
		</if>
	</select>
    <select id="insertResponseData">
        INSERT INTO BILL_PURCHASE_ORDER_RESPONSE ( PL_ORDER_ID, ORDER_ID, RESP_NUM, RESP_TIME, BD_CODE )
            VALUES ( #{plOrderId}, #{orderId}, #{respNum}, #{respTime}, #{bdCode} )
    </select>
    <select id="insertDelivery">
        insert into bill_purchase_delivery
          (ship_id, order_id, supplier_id, load_id, sender,
          sender_phone, ship_store, ship_time, taker, taker_phone,
          take_address, taker_store, operate, operate_time, status)
        values
          (#{id}, #{ordNo}, #{supId}, #{loadNo}, #{sender,jdbcType=VARCHAR},
          #{senderTel,jdbcType=VARCHAR}, #{shipStore,jdbcType=VARCHAR}, #{shipTime,jdbcType=DATE}, #{taker,jdbcType=VARCHAR}, #{takerTel,jdbcType=VARCHAR},
          #{takerAddr,jdbcType=VARCHAR}, #{takerStore,jdbcType=VARCHAR}, #{createBy,jdbcType=VARCHAR}, #{createTime}, '1')
    </select>
    <select id="deleteDelivery">
        delete from bill_purchase_delivery where ship_id = #{id}
    </select>
    <select id="insertDeliveryDetail">
        insert into bill_purchase_delivery_detail
          (id, ship_id, material_code, material_name,
          factory_code, spec, unit, item_no,
          num, batch_no, batch_lot, validity_date, production_date,
          purchase_price, is_pack, pack_type, pack_no, pack_num,
          pack_quantity, order_id, pl_order_id, invoice_no, invoice_time,status)
        values
          (#{id}, #{shipId}, (SELECT MATERIAL_CODE FROM DIC_MATERIAL where BD_CODE=#{matCode}),#{matName},
          (select FACTORY_CODE from BILL_PURCHASE_ORDER_DETAIL where ORDER_ID=#{ordNo} and MATERIAL_CODE=#{matId}), #{spec}, #{unit,jdbcType=VARCHAR}, 1,
          #{sendNum}, #{batchNo}, #{batchLot}, #{validDate}, #{prodDate},
          #{price}, #{isPkg,jdbcType=DECIMAL}, #{pkgType}, #{pkgNo}, #{pkgNum},
          #{pkgCapacity}, #{ordNo}, #{id}, #{invoiceNo}, #{invoiceTime},0)
    </select>
    <select id="deleteDeliveryDetail">
        delete from bill_purchase_delivery_detail where ship_id = #{id}
    </select>
    <select id="insertMaterial">

    </select>
    <select id="deleteMaterial">

    </select>
    <select id="insertMaterialVar">

    </select>
    <select id="deleteMaterialVar">

    </select>
    <select id="insertSupply">

    </select>
    <select id="deleteSupply">

    </select>

</mapper>
